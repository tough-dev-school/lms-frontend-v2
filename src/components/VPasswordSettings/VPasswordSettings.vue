<script lang="ts" setup>
  import { ref } from 'vue';
  import VHeading from '@/components/VHeading/VHeading.vue';
  import VButton from '@/components/VButton/VButton.vue';
  import VCard from '@/components/VCard/VCard.vue';
  import VTextInput from '@/components/VTextInput/VTextInput.vue';
  import useAuth from '@/stores/auth';

  export interface Props {
    uid?: string;
    token?: string;
  }

  const auth = useAuth();

  const newPassword1 = ref('');
  const newPassword2 = ref('');

  const props = defineProps<Props>();
  const emit = defineEmits<{ save: [] }>();

  const savePassword = async () => {
    await auth.changePassword({
      newPassword1: newPassword1.value,
      newPassword2: newPassword2.value,
      uid: props.uid,
      token: props.token,
    });

    emit('save');
  };
</script>

<template>
  <VCard>
    <VHeading
      v-if="!auth.token"
      class="mb-24"
      level="1"
      data-testid="reset-heading"
      >Сброс пароля</VHeading
    >
    <VHeading v-else class="mb-24" level="2" data-testid="change-heading"
      >Пароль</VHeading
    >
    <div class="flex flex-col items-start gap-16 tablet:gap-24">
      <VTextInput
        v-model="newPassword1"
        type="password"
        label="Новый пароль"
        data-testid="password1" />
      <VTextInput
        v-model="newPassword2"
        type="password"
        label="Повторите пароль"
        data-testid="password2" />
    </div>
    <template #footer>
      <VButton data-testid="save" @click="savePassword">Сохранить</VButton>
    </template>
  </VCard>
</template>
