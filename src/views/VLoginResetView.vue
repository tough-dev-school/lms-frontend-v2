<script lang="ts" setup>
  import VHeading from '@/components/VHeading.vue';
  import VButton from '@/components/VButton.vue';
  import VCard from '@/components/VCard.vue';
  import VTextInput from '@/components/VTextInput.vue';
  import { ref } from 'vue';
  import { onKeyStroke } from '@vueuse/core';
  import useAuth from '@/stores/auth';
  import { useRouter } from 'vue-router';

  const auth = useAuth();
  const router = useRouter();

  const email = ref('');

  const handleResetRequest = async () => {
    await auth.requestReset(email.value);
  };

  onKeyStroke('Enter', (e: KeyboardEvent) => {
    if (!email.value) return;
    handleResetRequest();

    e.preventDefault();
  });
</script>

<template>
  <VCard class="mt-[25vh]">
    <VHeading tag="h1" class="mb-32">Сброс пароля</VHeading>
    <VTextInput
      label="Электронная почта"
      tip="Мы отправим ссылку для сброса пароля по этому адресу"
      type="email"
      v-model="email"
      data-testid="email" />
    <template #footer>
      <VButton
        @click="handleResetRequest"
        :disabled="!email"
        class="flex-grow"
        data-testid="send"
        >Отправить письмо</VButton
      >
      <VButton
        appearance="link"
        @click="router.push({ name: 'login' })"
        class="flex-grow"
        data-testid="password">
        Войти по паролю
      </VButton>
    </template>
  </VCard>
</template>
