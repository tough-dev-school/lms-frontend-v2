# LMS Frontend [![ci](https://github.com/tough-dev-school/lms-frontend-v2/actions/workflows/ci.yml/badge.svg)](https://github.com/tough-dev-school/lms-frontend-v2/actions/workflows/ci.yml)

## Overall code style and recommndations

- We don't use pinia. Data is received from `vue-query`, shared code/state when needed is achieved via `vueuse`.
- Types and api methods are autogenerated from OpenAPI using `generate-sdk` script. Bugs in generated schemes must be reported to backend.
- We use regression and unit tests + typescript to ensure app stability.
- We use storybook as source for regression tests, and to test UI edgecase. It's also important tool to allow communication inside team.

## Backend Setup

### Docker Backend

Start the backend services using Docker Compose:

```bash
docker compose up
```

**Important**: You need to authenticate with [GitHub Container Registry](https://docs.github.com/en/packages/guides/configuring-docker-for-use-with-github-packages#authenticating-with-a-personal-access-token) first. Make sure to login to `https://ghcr.io`, not `https://docker.pkg.github.com`.

The Docker setup includes:

- **Backend**: Django application running on port 8000
- **PostgreSQL**: Database running on port 5432
- **Redis**: Cache service

### Services

- Backend API: http://localhost:8000
- Frontend dev server: http://localhost:3000
- Storybook: http://localhost:3001

## Development

### Install Dependencies

```bash
pnpm install
```

### Run Development Server

```bash
pnpm run dev
```

### Build for Production

```bash
pnpm run build
```

### Preview Production Build

```bash
pnpm run preview
```

## Code Quality & Testing

### Unit Tests

```bash
# Run unit tests
pnpm run test:unit

# Run with coverage
pnpm run test:unit:coverage
```

### Code Checks

```bash
# Type checking
pnpm run test:type

# Linting
pnpm run test:lint

# Fix linting issues
pnpm run fix:lint

# Run all fixes
pnpm run fix
```

## Visual Regression Testing

Visual regression tests are running in CI. Please don't run them on your computer as they will not match with the ones run in CI.

### Handling Regression Test Failures

When regression tests fail due to visual changes:

1. Go to the "Summary" tab of the failed CI job and download the `diff.zip` file
2. Review the differences in the downloaded archive:
   - If differences are unexpected → fix the issues
   - If differences are expected → proceed to update screenshots
3. Go to the [Update Regression Action](https://github.com/tough-dev-school/lms-frontend-v2/actions/workflows/update-regression.yml) and run it for your branch
4. Download `updated-screenshots.zip` from the "Summary" tab of the update job
5. Replace images in `tests/__image_snapshots__/` with images from `updated-screenshots.zip` and commit these changes
6. CI will now pass

### Adding New Regression Tests

To add new visual tests, add a new route to the scenarios array in `tests/regression.test.ts` and follow steps 3-5 above.

## API Integration

### Generate SDK

```bash
pnpm run generate-sdk
```

This generates TypeScript API client code from the backend OpenAPI specification.
